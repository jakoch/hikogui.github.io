<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HikoGUI: How to draw</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="version_dropdown.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HikoGUI
   </div>
   <div id="projectbrief">A low latency retained GUI</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">How to draw</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Drawing is done through the <code>hi::draw_context</code> object that is passed to <code>hi::widget::draw()</code> when drawing a frame. The <code>hi::draw_context</code> has several <code>draw_*()</code> member functions that allow you to draw shapes, glyphs, text and images.</p>
<p>The first argument to those <code>draw_*()</code> functions is a reference to the widget's <code><a class="el" href="a07214.html" title="The layout of a widget.">hi::widget_layout</a></code> object. This object was stored by the <code>hi::widget::set_layout()</code> function and contains the to-window transformation matrix and clipping rectangle used when drawing.</p>
<p>The second optional argument is an axis-aligned clipping rectangle which will be intersected with the layout's clipping rectangle. This can be used to specifically clip the shape, glyph or image being drawn.</p>
<h1><a class="anchor" id="autotoc_md101"></a>
Concepts</h1>
<h2><a class="anchor" id="autotoc_md102"></a>
Coordinate system</h2>
<p>The coordinate system for drawing is relative to the widget, including the elevation where the rectangle is drawn on the z-buffer. The origin of the coordinate system is in the left-bottom corner of the pixel in the left-bottom corner of the widget. The axes extend to the right, up and toward the user.</p>
<p>The coordinates, widths and radii are in virtual pixels. On high resolution displays there will be an integer scaling factor to map the virtual pixels onto physical pixels. In this library when you read "pixel" without an explicit qualifier, it is meant to be "virtual pixels".</p>
<h2><a class="anchor" id="autotoc_md103"></a>
Corners</h2>
<p>The order of the corners in the <code>hi::quad</code>, <code>hi::quad_color</code> and <code>hi::corner_radii</code> are always:</p>
<ul>
<li>left-bottom,</li>
<li>right-bottom,</li>
<li>left-top and</li>
<li>right-top.</li>
</ul>
<h2><a class="anchor" id="autotoc_md104"></a>
Edges</h2>
<p>The order of in the <code>hi::margins</code> are always:</p>
<ul>
<li>bottom</li>
<li>left</li>
<li>top</li>
<li>right</li>
</ul>
<h1><a class="anchor" id="autotoc_md105"></a>
Drawing shapes</h1>
<h2><a class="anchor" id="autotoc_md106"></a>
Drawing rectangles</h2>
<p>In the example below we draw a rectangle with a border and rounded corners:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> draw(hi::draw_context <span class="keyword">const</span> &amp;context) <span class="keyword">noexcept</span> <span class="keyword">override</span></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> polygon = hi::quad{</div>
<div class="line">        point3{10.0f, 10.0f, 0.0f},</div>
<div class="line">        point3{60.0f, 10.0f, 0.0f},</div>
<div class="line">        point3{10.0f, 60.0f, 0.0f},</div>
<div class="line">        point3{60.0f, 60.0f, 0.0f}};</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> red = hi::color{1.0f, 0.0f, 0.0f, 1.0f};</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> blue = hi::color{1.0f, 0.0f, 0.0f, 1.0f};</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> border_width = 2.0f</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> corners = hi::corner_radii{3.0f, 3.0f, 3.0f, 3.0f};</div>
<div class="line">    context.draw_box(_layout, polygon, red, blue, border_width, hi::border_side::inside, corners);</div>
<div class="line">}</div>
</div><!-- fragment --><p>To get the rectangle to align to edges of pixels, you want to specify the quad as integer coordinates; and for the border side to specify either <code>inside</code> or <code>outside</code>, this will yield sharp borders.</p>
<p>The actual polygon send to the GPU is extended to include the part of the border that falls outside the polygon and an extra physical pixel for anti-aliasing.</p>
<h2><a class="anchor" id="autotoc_md107"></a>
Drawing circles</h2>
<p>In the example below we draw a circle with a border:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> draw(hi::draw_context <span class="keyword">const</span> &amp;context) <span class="keyword">noexcept</span> <span class="keyword">override</span></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> polygon = hi::circle{point3{35.0f, 35.0f, 0.0f}, 25.0f};</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> red = hi::color{1.0f, 0.0f, 0.0f, 1.0f};</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> border_width = 2.0f</div>
<div class="line">    context.draw_circle(_layout, polygon, line_width, red, hi::line_end_cap::round, hi::line_end_cap::round);</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>hi::draw_context::draw_circle()</code> is a convenience-function for <code>hi::draw_context::draw_box()</code> A circle is a square with rounded corners with the corner diameter set to the height/width of the square.</p>
<p>When drawing circles among rectangular objects, it is recommended to draw the circle at a 1-3% larger radius, so that the shape seems to be the same size and aligned to the flat edges of the rectangles.</p>
<h2><a class="anchor" id="autotoc_md108"></a>
Drawing lines</h2>
<p>In the example below we draw a line with rounded end points:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> draw(hi::draw_context <span class="keyword">const</span> &amp;context) <span class="keyword">noexcept</span> <span class="keyword">override</span></div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> line = hi::line{</div>
<div class="line">        point3{10.0f, 10.0f, 0.0f},</div>
<div class="line">        point3{50.0f, 50.0f, 0.0f}};</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> red = hi::color{1.0f, 0.0f, 0.0f, 1.0f};</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> blue = hi::color{1.0f, 0.0f, 0.0f, 1.0f};</div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> line_width = 2.0f</div>
<div class="line">    context.draw_line(_layout, line, red, blue, border_width, hi::border_side::inside);</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>hi::draw_context::draw_line()</code> is a convenience-function for <code>hi::draw_context::draw_box()</code> A line is a thin rectangle with rounded corners with the corner diameter set to the width of the line.</p>
<p>When drawing horizontal or vertical lines, you may want to position the line so that it goes through the center of the pixels to get a sharp line. The origin of the coordinate system is in the left-bottom corner of the most left bottom pixel of a widget.</p>
<h1><a class="anchor" id="autotoc_md109"></a>
Drawing images</h1>
<p>There are three steps for drawing an image:</p><ul>
<li>Loading an png-image file from disk.</li>
<li>Uploading the image to the GPU.</li>
<li>Drawing the polygons to display the image.</li>
</ul>
<p>Here we load the <code>mars3.png</code> file from a resource directory from the constructor:</p>
<div class="fragment"><div class="line">drawing_widget(hi::gui_window &amp;window, <a class="code hl_class" href="a07202.html">hi::widget</a> *parent) noexcept :</div>
<div class="line">    widget(parent), _image(<a class="code hl_class" href="a04706.html">hi::URL</a>(<span class="stringliteral">&quot;resource:mars3.png&quot;</span>)) {}</div>
<div class="ttc" id="aa04706_html"><div class="ttname"><a href="a04706.html">hi::URL</a></div><div class="ttdoc">Universal Resource Locator.</div><div class="ttdef"><b>Definition</b> URL.hpp:44</div></div>
<div class="ttc" id="aa07202_html"><div class="ttname"><a href="a07202.html">hi::widget</a></div><div class="ttdoc">An interactive graphical object as part of the user-interface.</div><div class="ttdef"><b>Definition</b> widget.hpp:45</div></div>
</div><!-- fragment --><p>During <code>set_constraints()</code> we try to construct a <code>hi::paged_image</code>. In the <code>set_constraints()</code> function this may fail when the window is still being created; therefor, we keep reconstraining until it succeeds.</p>
<p>This version of the <code>hi::paged_image{}</code> constructor also directly uploads the image to the GPU. It is also possible to make a <code>hi::paged_image</code> with just a width and a height and then upload the image at a later time.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="a07210.html">hi::widget_constraints</a> <span class="keyword">const</span> &amp;set_constraints(set_constraints_context <span class="keyword">const</span> &amp;context) <span class="keyword">noexcept</span> <span class="keyword">override</span></div>
<div class="line">{</div>
<div class="line">    _layout = {};</div>
<div class="line">    <span class="keywordflow">if</span> (_image_was_modified.exchange(<span class="keyword">false</span>)) {</div>
<div class="line">        <span class="keywordflow">if</span> (not (_image_backing = hi::paged_image{window.surface.get(), _image})) {</div>
<div class="line">            <span class="comment">// Could not get an image, retry.</span></div>
<div class="line">            _image_was_modified = <span class="keyword">true</span>;</div>
<div class="line">            request_reconstrain(context);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> _constraints = {{100, 100}, {150, 150}, {400, 400}, context.theme-&gt;margin};</div>
<div class="line">}</div>
<div class="ttc" id="aa07210_html"><div class="ttname"><a href="a07210.html">hi::widget_constraints</a></div><div class="ttdoc">The constraints of a widget.</div><div class="ttdef"><b>Definition</b> widget_constraints.hpp:26</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md110"></a>
Drawing glyphs</h1>
<h1><a class="anchor" id="autotoc_md111"></a>
Drawing text</h1>
<h2><a class="anchor" id="autotoc_md112"></a>
Text shaping</h2>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.8-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 29 2023 19:34:01 for HikoGUI by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
<script>
mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    themeVariables: {
    primaryColor: '#f4f4ff',
    secondaryColor: 'rgba(244,244,255,0.9)',
    tertiaryColor: '#F9FAFC',
    },
});
</script>
</body>
</html>
</html>